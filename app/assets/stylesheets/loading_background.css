.loading-screen {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;

  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
  overflow: hidden;

  /* 白ベール＋淡いメタリックレインボー */
  background:
    /* 白いベール */
    linear-gradient(
      rgba(255,255,255,0.35),
      rgba(255,255,255,0.35)
    ),
    /* 柔らかい金属ハイライト */
    radial-gradient(1000px 480px at 50% 18%,
      rgba(255,255,255,0.40) 0%,
      rgba(255,255,255,0.16) 35%,
      rgba(255,255,255,0.00) 70%
    ),
    /* さらに淡めレインボー */
    linear-gradient(
      120deg,
      #4a4e6a 0%,
      #ff9fd6 16%,
      #ffd7a8 30%,
      #fbffbf 44%,
      #a8fff0 58%,
      #a5d8ff 72%,
      #cbb8ff 86%,
      #ff9fd6 96%,
      #4a4e6a 100%
    );

  background-size: 100% 100%, 100% 100%, 360% 360%;
  background-position: 0 0, 50% 18%, 0% 50%;
  background-attachment: fixed;

  filter: saturate(1.04) contrast(1.05);
}

.loading-screen.active {
  opacity: 1;
  pointer-events: all;
  animation: loadingRainbowFlow 8s ease-in-out infinite;
}

.loading-screen .postbox-animation {
  position: relative;
  z-index: 3;
}

.loading-screen .warp-layer {
  position: absolute;
  inset: 0;
  z-index: 1;
  pointer-events: none;
  opacity: 0;
}

.loading-screen.active .warp-layer {
  opacity: 1;
}

.loading-screen .warp-layer::after {
  content: "";
  position: absolute;
  inset: -20%;
  background:
    radial-gradient(circle at 50% 50%,
      rgba(255,255,255,0.55) 0%,
      rgba(255,255,255,0.16) 18%,
      rgba(255,255,255,0.00) 48%
    ),
    radial-gradient(circle at 50% 50%,
      rgba(120,170,255,0.18) 0%,
      rgba(255,140,200,0.10) 22%,
      rgba(0,0,0,0.00) 56%
    );
  filter: blur(6px);
  transform-origin: center;
  mix-blend-mode: screen;
  animation: warpPulse 2.6s ease-in-out infinite,
             warpRotate 6.5s linear infinite;
}

.loading-screen .warp-layer::before {
  content: "";
  position: absolute;
  inset: 0;

  background:
    conic-gradient(from 0deg,
      rgba(255,255,255,0.00) 0deg,
      rgba(255,255,255,0.16) 6deg,
      rgba(255,255,255,0.00) 14deg,
      rgba(255,255,255,0.12) 22deg,
      rgba(255,255,255,0.00) 32deg,
      rgba(255,255,255,0.10) 42deg,
      rgba(255,255,255,0.00) 55deg,
      rgba(255,255,255,0.14) 64deg,
      rgba(255,255,255,0.00) 78deg,
      rgba(255,255,255,0.12) 92deg,
      rgba(255,255,255,0.00) 110deg,
      rgba(255,255,255,0.16) 126deg,
      rgba(255,255,255,0.00) 145deg,
      rgba(255,255,255,0.12) 162deg,
      rgba(255,255,255,0.00) 180deg,
      rgba(255,255,255,0.14) 196deg,
      rgba(255,255,255,0.00) 214deg,
      rgba(255,255,255,0.12) 232deg,
      rgba(255,255,255,0.00) 252deg,
      rgba(255,255,255,0.16) 270deg,
      rgba(255,255,255,0.00) 290deg,
      rgba(255,255,255,0.12) 312deg,
      rgba(255,255,255,0.00) 336deg,
      rgba(255,255,255,0.14) 360deg
    );
  -webkit-mask-image: radial-gradient(circle at 50% 50%,
    rgba(0,0,0,1) 0%,
    rgba(0,0,0,0.85) 18%,
    rgba(0,0,0,0.10) 52%,
    rgba(0,0,0,0.00) 78%
  );

  mask-image: radial-gradient(circle at 50% 50%,
    rgba(0,0,0,1) 0%,
    rgba(0,0,0,0.85) 18%,
    rgba(0,0,0,0.10) 52%,
    rgba(0,0,0,0.00) 78%
  );

  mix-blend-mode: soft-light;
  opacity: 0.9;
  filter: blur(0.6px);
  transform-origin: center;

  animation: particlePull 1.8s ease-in-out infinite,
             particleSpin 5.2s linear infinite;
}

@keyframes loadingRainbowFlow {
  0%   { background-position: 0 0, 50% 18%, 0% 50%; }
  50%  { background-position: 0 0, 50% 18%, 100% 50%; }
  100% { background-position: 0 0, 50% 18%, 0% 50%; }
}

@keyframes warpPulse {
  0%   { opacity: 0.70; transform: scale(1.00); }
  50%  { opacity: 1.00; transform: scale(1.06); }
  100% { opacity: 0.70; transform: scale(1.00); }
}

@keyframes warpRotate {
  0%   { transform: rotate(0deg) scale(1.02); }
  100% { transform: rotate(360deg) scale(1.02); }
}

@keyframes particlePull {
  0%   { transform: scale(1.20); opacity: 0.65; }
  50%  { transform: scale(0.98); opacity: 0.95; }
  100% { transform: scale(1.20); opacity: 0.65; }
}

@keyframes particleSpin {
  0%   { transform: rotate(0deg) scale(1.15); }
  100% { transform: rotate(360deg) scale(1.15); }
}

@media (max-width: 768px) {
  .loading-screen {
    /* モバイルでは fixed 背景を避け、色変化を止めずに負荷を下げる */
    background-attachment: scroll;
    background-size: 100% 100%, 100% 100%, 260% 260%;
  }

  .loading-screen.active {
    animation-duration: 12s;
  }
}
