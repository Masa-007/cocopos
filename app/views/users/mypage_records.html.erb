<main class="records-page flex-grow pt-24 pb-12">
  <div class="container mx-auto max-w-6xl px-6">
    <div class="text-center mb-10">
      <h1 class="text-3xl font-bold text-gray-800 mb-2">🗂️ これまでの記録</h1>
      <p class="text-gray-600">投稿の積み重ねを振り返ってみましょう</p>
    </div>

    <% base_month = Date.new(@year, @month, 1) %>
    <% prev_month = base_month.prev_month %>
    <% next_month = base_month.next_month %>
    <% current_month = Time.zone.today.beginning_of_month.to_date %>
    <% preserved = request.query_parameters.symbolize_keys.except(:year, :month, :page) %>

    <div class="mx-auto mb-6 flex w-full max-w-2xl items-center justify-between">
      <%= link_to "←",
            mypage_records_path(preserved.merge(year: prev_month.year, month: prev_month.month)),
            class: "month-nav text-2xl font-bold text-gray-600 hover:text-gray-800 transition-colors duration-200",
            title: "先月へ" %>

      <p class="text-2xl font-bold text-gray-600 tracking-wide">
        <%= "#{@year}年 #{@month}月" %>
      </p>

      <div class="flex items-center gap-3">
        <% if next_month > current_month %>
          <span class="month-nav text-2xl font-bold text-gray-300" title="翌月へ">→</span>
        <% else %>
          <%= link_to "→",
                mypage_records_path(preserved.merge(year: next_month.year, month: next_month.month)),
                class: "month-nav text-2xl font-bold text-gray-600 hover:text-gray-800 transition-colors duration-200",
                title: "翌月へ" %>
        <% end %>
      </div>
    </div>

       <div class="monthly-stats">
        <div class="monthly-stat-card">
        <p class="monthly-stat-label">今月の投稿数</p>
        <p class="monthly-stat-value"><%= @monthly_post_count %> 件</p>
       </div>

       <div class="monthly-stat-card">
        <p class="monthly-stat-label">連続投稿日数</p>
        <p class="monthly-stat-value"><%= @monthly_post_streak %> 日</p>
       </div>
    </div>

    <%= render "users/future_posts_summary",
               future_posts: @future_posts,
               future_insight: @future_insight,
               filter_path: method(:mypage_records_path) %>

    <%= render "users/mood_meter",
               mood_insight: @mood_insight,
               mood_chart_data: @mood_chart_data %>

    <%= render "users/thanks_points",
               thanks_points: @thanks_points,
               thanks_recipients_summary: @thanks_recipients_summary,
               thanks_insight: @thanks_insight %>
  </div>
</main>

