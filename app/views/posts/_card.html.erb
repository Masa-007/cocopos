<div class="post-card bg-white rounded-3xl shadow-lg overflow-hidden hover:shadow-xl transition">

  <%= link_to post_path(post, from: from),
              data: { turbo: false },
              class: "block no-underline text-gray-800" do %>

    <!-- ヘッダー -->
    <div class="post-card-header <%= post.post_type %> flex justify-between items-center px-6 py-4 border-b">
      <span class="font-semibold flex items-center gap-2">
        <%= post.post_type_icon %> <%= post.post_type_name %>

        <!-- 心の整理箱：気分 -->
        <% if post.organize? && post.mood.present? %>
          <% mood_label = Post::MOODS[post.mood.to_sym][:label] %>
          <% emoji = mood_label[/^\S+/] %>
          <% text  = mood_label.sub(/^\S+\s*/, "") %>

          <span class="inline-flex items-center gap-1 text-sm px-1.5 py-0.5 bg-purple-50 text-purple-700 rounded-md">
            <span><%= emoji %></span>
            <span><%= text %></span>
          </span>
        <% end %>

        <!-- 未来宣言箱：進捗 -->
        <% if post.future? && post.progress.present? %>
          <span class="inline-flex items-center gap-1 text-sm px-1.5 py-0.5 bg-green-50 text-green-700 rounded-md">
            <% if post.progress == 100 %>
              🎉 達成済み
            <% else %>
              🎯 <%= post.progress %>%
            <% end %>
          </span>
        <% end %>
      </span>

        <% if post.thanks? && post.thanks_recipient_tag.present? %>
          <span class="inline-flex items-center gap-1 text-sm px-1.5 py-0.5 bg-pink-50 text-pink-700 rounded-md">
            <%= post.thanks_recipient_tag %>
          </span>
        <% end %>

      <span class="text-sm text-gray-500">
        <%= l post.created_at, format: :short %>
      </span>
    </div>

    <!-- 本文 -->
    <div class="px-6 py-4">
      <% if post.title.present? %>
        <h3 class="font-bold mb-2 text-lg"><%= h(post.title) %></h3>
      <% end %>

      <p class="text-gray-700 leading-relaxed">
        <%= truncate(strip_tags(post.body.to_s), length: 100) %>
      </p>
    </div>
  <% end %>

  <!-- フッター -->
  <div class="flex justify-between items-center text-sm text-gray-600 px-6 py-4 bg-gray-50 border-t">
    <div class="flex items-center gap-2 flex-wrap">
      <span><%= post.display_name %></span>

      <% if user_signed_in? && post.user == current_user && !post.is_public %>
        <span class="px-2 py-1 bg-gray-200 text-xs rounded-full">非公開</span>
      <% end %>

      <% if post.comment_allowed? %>
        <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full font-bold">
          💬 意見募集中
        </span>
      <% else %>
        <span class="px-2 py-1 bg-gray-200 text-xs rounded-full">
          💭 コメント不要
        </span>
      <% end %>
    </div>

    <%= render "posts/card_actions", post: post, from: from %>
  </div>

</div>

