<main class="flex-grow pt-24 pb-12">
  <div class="container mx-auto max-w-6xl px-6">

    <!-- === ページタイトル === -->
    <div class="text-center mb-10">
      <h1 class="text-4xl font-bold text-gray-800 mb-2">📮 みんなの投稿一覧</h1>
      <p class="text-gray-600">心の目安箱に投函された想い</p>
    </div>

    <!-- === 絞り込み・並び替えバー === -->
    <div class="filter-bar">

      <!-- 絞り込みボタン群 -->
      <div class="filter-buttons">
        <span class="filter-label">絞り込み：</span>
        <%= link_to "すべて", posts_path(sort: params[:sort]), 
              data: { turbo_frame: "_top" },
              class: "filter-btn #{'active' if params[:filter].blank? || params[:filter] == 'all'}" %>

        <%= link_to "🌱 未来宣言箱", posts_path(filter: 'future', sort: params[:sort]), 
              data: { turbo_frame: "_top" },
              class: "filter-btn #{'active' if params[:filter] == 'future'}" %>

        <%= link_to "🌈 心の整理箱", posts_path(filter: 'organize', sort: params[:sort]), 
              data: { turbo_frame: "_top" },
              class: "filter-btn #{'active' if params[:filter] == 'organize'}" %>

        <%= link_to "💌 感謝箱", posts_path(filter: 'thanks', sort: params[:sort]), 
              data: { turbo_frame: "_top" },
              class: "filter-btn #{'active' if params[:filter] == 'thanks'}" %>
      </div>

      <!-- 並び替えセレクト -->
      <%= form_with url: posts_path, method: :get, data: { turbo_frame: "_top" }, local: true, class: "filter-right" do |f| %>
        <%= f.hidden_field :filter, value: params[:filter] %>
        <select name="sort" onchange="this.form.requestSubmit()" class="sort-select">
          <option value="new" <%= 'selected' if params[:sort] != 'old' %>>新着順</option>
          <option value="old" <%= 'selected' if params[:sort] == 'old' %>>古い順</option>
        </select>
      <% end %>
    </div>

    <!-- === 投稿グリッド === -->
    <div id="posts-grid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
      <% @posts.each do |post| %>
        <%= link_to post_path(post),
          class: "post-card block no-underline text-gray-800",
          data: { turbo_frame: "_top", id: post.id, category: post.post_type } do %>

          <div class="post-card-header <%= post.post_type %>">
            <span class="font-semibold"><%= post.post_type_icon %> <%= post.post_type_name %></span>
            <span class="text-sm text-gray-500"><%= l post.created_at, format: :short %></span>
          </div>

          <div class="post-card-body">
            <% if post.title.present? %>
              <h3 class="post-title"><%= h(post.title) %></h3>
            <% end %>
            <p class="post-content"><%= truncate(strip_tags(post.body), length: 100) %></p>
          </div>

          <div class="post-card-footer">
            <span class="post-author"><%= post.display_name %></span>
            <% if post.opinion_needed? %>
              <span class="comment-status">💬 意見募集中</span>
            <% end %>
          </div>

        <% end %>
      <% end %>

      <% if @posts.empty? %>
        <div class="col-span-full text-center py-12 text-gray-500">
          まだ投稿がありません。
        </div>
      <% end %>
    </div>

    <% if @posts.respond_to?(:current_page) %>
      <div class="flex justify-center mt-12">
        <%= paginate @posts %>
      </div>
    <% end %>

  </div>
</main>
